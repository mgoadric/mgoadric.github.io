<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Hendrix College Arboretum</title>
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
        <!-- Google fonts-->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Merriweather+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Varela+Round" rel="stylesheet" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
     integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI="
     crossorigin=""/>
     <link href="css/styles.css" rel="stylesheet" />
     <link href="css/greysite.css" rel="stylesheet" />
    </head>
    <body id="page-top">
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
            <div class="container px-4 px-lg-5">
                <a class="navbar-brand" href="#page-top">Hendrix Arboretum</a>
                <button class="navbar-toggler navbar-toggler-right" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    Menu
                    <i class="fas fa-bars"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item"><a class="nav-link" href="#about">About</a></li>
                        <li class="nav-item"><a class="nav-link" href="#mapsection">Map</a></li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- Masthead-->
        <header class="masthead">
            <div class="container px-4 px-lg-5 d-flex h-100 align-items-center justify-content-center">
                <div class="d-flex justify-content-center">
                    <div class="text-center">
                        <h1 class="mx-auto my-0 text-uppercase">Hendrix Arboretum</h1>
                        <h2 class="text-white-50 mx-auto mt-2 mb-5">Cataloging the location and species of over 1,000 trees
                            at Hendrix College, based on a census that began in June, 1995.</h2>
                        <a class="btn btn-primary" href="#mapsection">Find a Tree</a>
                    </div>
                </div>
            </div>
        </header>

        <!-- About-->
        <section class="about-section text-center" id="about">
            <div class="container px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-lg-8">
                        <h2 class="text-white mb-4">The Hendrix College Campus Arboretum</h2>
                        <p class="text-white-50">
                            Consistent with its community orientation and the educational goals of Hendrix
                            College, the development of the campus arboretum was intended to provide an
                            educational center for not only Hendrix College, but for the other colleges, public
                            schools, and the general public in the Central Arkansas area, as well as for other
                            visitors to the college.
                        </p>
                     
                        <p class="text-white-50">A secondary aim of the census was                            
                            to provide a guide for future plantings, with the goal of eventually including all species
                            common to Arkansas and its surrounding states. The Campus Arboretum continues 
                            to be a work in progress, as the campus experiences
                            growth and development. 
                        </p>
 

                    </div>
                </div>
            </div>
        </section>

        <!-- About-->
        <section class="about-section text-center" id="mapsection">
            <div class="container px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-lg-12">
                        <h2 class="text-white mb-4">Map</h2>
                    </div>
                    <div class="col-lg-4">

<div class="input-group mb-3">
  <input id="SearchTreeID" type="text" class="form-control" placeholder="Tree ID" aria-label="Tree ID" aria-describedby="button-addon2">
  <button class="btn btn-primary" onclick="searchByNum()" type="button" id="button-addon2">Search</button>
</div>
</div>

<div class="col-lg-4">
<div class="dropdown mb-3">
  <button class="btn btn-primary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
    Search By Category
  </button>
  <ul id="category" class="dropdown-menu">

  </ul>
</div>
</div>

<!--
                    <div class="col-lg-4">
                        <h2 class="search_buttons">Search By Category</h2>
                        <select class="search_things" id="category" name="number" onchange="searchBySpecialty()">
                            <option value="">Select a category</option>
                        </select>
                    </div>

                -->
                    <div class="col-lg-4">
                        <input class="btn btn-primary mb-3" type="button" onclick="randomTree()" id="random" value="Random Tree" />
                    </div>

                    </div>
                    <div class="row gx-4 gx-lg-5 justify-content-center">

                    <div class="col-lg-12">
                        <div id="map"></div> 
                        <h2 class="text-white mb-4"></h2>
                    </div>
                </div>
            </div>
        </section>


        <section class="projects-section bg-light" id="tree">
            <div class="container px-4 px-lg-5">
                <!-- Featured Project Row-->
                <div class="row gx-0 mb-4 mb-lg-5 align-items-center">
                    <div class="col-xl-6 col-lg-6">
                        <div id="tree_image">
                            <img class="img-fluid mb-3 mb-lg-0" src="testing" onerror="this.src='assets/img/stockTree.jpg';" id="tree_img" alt="Tree Unavailable" />
                        </div>
                    </div>
                    <div class="col-xl-6 col-lg-6">
                        <div id="tree_info" class="featured-text text-center text-lg-left">
                            <h1 id="tree_title">Tree #223</h1>
                            <h5>Common Name</h5>
                            <p class="text-black-50" id="tree_common">Elm, American</p>
                            <h5>Scientific Name</h5>
                            <p class="text-black-50" id="tree_scientific">Ulmus americana L.</p>
                            <h5>Location</h5>
                            <p class="text-black-50" id="tree_location">Volleyball Court - S</p>
                            <h5>GPS Coord</h5>
                            <p class="text-black-50" id="tree_gps">35.0982583, -92.4405056</p>
                        </div>
                    </div>
                </div>
             </div>
        </section>
 
         <!-- Projects-->

        <!-- Footer-->
        <footer class="footer bg-black small text-center text-white-50"><div class="container px-4 px-lg-5">Developed by <a href ="https://discotraystudios.github.io/" target="_blank">
            <img class="footer-image" src="assets/img/DiscoTray_logo_bling-2.png">
        </a></div></footer>
        
        <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
        <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
            integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
            crossorigin=""></script>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>

        <script>
            var map = null;
            var markers = null;
            var large = true;
            var baseurl = "https://hendrix-arboretum.azurewebsites.net"
            //var baseurl = "";
        
            $(document).ready(function () {
                leafletfunc();
                addCategories();
                $("#tree_info").hide();
                $("#tree_image").hide();
            });
        
            function leafletfunc() {
                map = L.map('map').setView([35.0995, -92.4407], 16);
                const resizeObserver = new ResizeObserver(() => {
                    setTimeout(function () {
                        map.invalidateSize();
                        if (large) {
                            map.panTo([35.0995, -92.4407]);
                        } 
                    }, 400);
                });
                const mapDiv = document.getElementById("map");
                resizeObserver.observe(mapDiv);
                markers = L.layerGroup();
                map.addLayer(markers);
                L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                    attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
                }).addTo(map);
            }
        
            function addTrees(data) {
                if (markers != null){
                    markers.clearLayers();
                }
        
                if (data.length == 0) {
                    randomTree();
                } else {
                    if (data.length == 1) {
                        tree_popup(data[0])
                    } else {
                        hide_tree_panes();
                    }
        
                    console.log("Adding Trees")
                    for (let i = 0; i < data.length; i++) {
                        console.log("Adding tree")
                        var marker = L.marker([data[i].latitude, data[i].longitude], {
                            title: data[i].treeID
                        });
        
                        marker.bindPopup('<h3>Tree #<a href="#tree">' + data[i].id + '</a></h3>');
                        markers.addLayer(marker);
                        marker.addEventListener('click', event => {
                            tree_popup(data[i]);
                        });
                    }
                }
            }
        
            function tree_popup(tree) {
                $("#tree_title").text("Tree #" + tree.id);
                $("#tree_common").text(tree.commonName);
                $("#tree_scientific").text(tree.scientificName);
                $("#tree_location").text(tree.locationName);
                $("#tree_gps").text(tree.latitude + ", " + tree.longitude);
                $("#tree_img").attr("src", tree.imageURL);
                console.log(tree.imageURL);
        
                show_tree_panes(tree);
        
                setTimeout(function () {
                    map.panTo([tree.latitude, tree.longitude]);
                }, 500);
            }
        
            function show_tree_panes(tree) {
                if (large) {
                    $("#tree_info").show(1000);
                    $("#tree_image").show(1000);
                    //$("#mainscreen").removeClass("col-md-12");
                    //$("#mainscreen").addClass("col-md-4");
        
                    large = false;    
                }
            }
        
            function hide_tree_panes() {
                if (!large) {
                    $("#tree_info").hide(1000);
                    $("#tree_image").hide(1000);
                    //$("#mainscreen").removeClass("col-md-4");
                    //$("#mainscreen").addClass("col-md-12");
        
                    large = true;
                }
            }
        
            function addCategories() {
                $.ajax({
                    type: 'GET',
                    url: baseurl + '/API/Specialties/All',
                    data: { },
                    success: function (data) {
                        console.log("Found specialities");
                        $.each(data, function (i, item) {
                            $('#category').append(
                                $('<li><a class="dropdown-item" onclick="searchBySpecialty(\'' + 
                                    item.title + '\')">' + item.title + '</a></li>'));   

                        });
                    },
                    error: function (error) {
                        alert("Error: " + error);
                    }
                });
            }
        
        
            function searchByNum() {
                var str = $("#SearchTreeID").val();
                console.log(typeof str)
                $.ajax({
                    type: 'GET',
                    url: baseurl + '/API/Trees/',
                    data: { id: str },
                    success: function (data) {
                        addTrees(data);
                    },
                    error: function (error) {
                        alert("Error: " + error);
                    }
                });
            }
        
            function randomTree() {
                // tree #'s are in ranges of 1-1156 3000-3177 4000-4147 5000-5070 5300-5484
                //var num = Math.round(Math.random() * (1156))
                //var rand = num.toString()
                //console.log(rand)
                $.ajax({
                    type: 'GET',
                    url: baseurl + '/API/Trees/Random',
                    data: { },
                    success: function (data) {
                        addTrees(data);
                    },
                    error: function (error) {
                        alert("Error: " + error);
                    }
                });
            }
        
            function searchBySpecialty(category) {
                //console.log(document.getElementById("category").value)
                //var category = document.getElementById("category").value;
                console.log("Querying database")
                $.ajax({
                    type: 'GET',
                    url: baseurl + '/API/Specialties/',
                    data: { specialty: category },
                    success: function (data) {
                        console.log("Success Specialty")
                        addTrees(data);
                    },
                    error: function (error) {
                        alert("Error: " + error);
                    }
                });
            }
        
        </script>
        
    </body>
</html>
